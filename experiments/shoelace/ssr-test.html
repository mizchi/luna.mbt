<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shoelace SSR Test</title>

  <!-- Shoelace CSS - loaded early to prevent FOUCE -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/themes/light.css" />

  <style>
    /* Prevent FOUCE - hide undefined custom elements */
    :not(:defined) {
      visibility: hidden;
    }

    body {
      font-family: var(--sl-font-sans);
      padding: 2rem;
      max-width: 800px;
      margin: 0 auto;
    }

    .test-section {
      margin-bottom: 2rem;
      padding: 1rem;
      border: 1px solid #ddd;
      border-radius: 8px;
    }

    .test-section h2 {
      margin-top: 0;
    }

    .status {
      padding: 0.5rem 1rem;
      border-radius: 4px;
      margin-top: 0.5rem;
    }

    .status.pending { background: #fff3cd; }
    .status.success { background: #d4edda; }
    .status.error { background: #f8d7da; }
  </style>
</head>
<body>
  <h1>Shoelace SSR Test</h1>
  <p>このページはSSRシナリオをシミュレートします。</p>

  <!-- Test 1: Pre-rendered Custom Elements -->
  <div class="test-section">
    <h2>1. Pre-rendered Custom Elements (SSR Output)</h2>
    <p>サーバーで出力されたHTMLタグがクライアントで動作するか確認。</p>

    <!-- These would be output by SSR -->
    <sl-button variant="primary" id="ssr-btn-1">SSR Button 1</sl-button>
    <sl-button variant="success" id="ssr-btn-2">SSR Button 2</sl-button>

    <div class="status pending" id="status-1">Waiting for hydration...</div>
  </div>

  <!-- Test 2: Attribute Preservation -->
  <div class="test-section">
    <h2>2. Attribute Preservation</h2>
    <p>SSRで設定された属性がクライアントで保持されるか確認。</p>

    <sl-input
      id="ssr-input"
      label="Pre-filled Input"
      value="This was set by SSR"
      placeholder="Type here"
    ></sl-input>

    <br><br>

    <sl-checkbox id="ssr-checkbox" checked>Pre-checked checkbox</sl-checkbox>

    <br><br>

    <sl-progress-bar id="ssr-progress" value="75"></sl-progress-bar>

    <div class="status pending" id="status-2">Checking attributes...</div>
  </div>

  <!-- Test 3: Event Binding After Hydration -->
  <div class="test-section">
    <h2>3. Event Binding After Hydration</h2>
    <p>Hydration後にイベントが正しくバインドされるか確認。</p>

    <sl-input id="hydrated-input" label="Type to test events" placeholder="Start typing..."></sl-input>
    <p>Input value: <code id="input-value">-</code></p>

    <sl-button id="hydrated-button" variant="primary">Click me</sl-button>
    <p>Click count: <code id="click-count">0</code></p>

    <div class="status pending" id="status-3">Waiting for interaction...</div>
  </div>

  <!-- Test 4: Complex Component State -->
  <div class="test-section">
    <h2>4. Complex Component State</h2>
    <p>複雑なコンポーネントの状態がHydration後も保持されるか。</p>

    <sl-select id="ssr-select" label="Select an option" value="option-2">
      <sl-option value="option-1">Option 1</sl-option>
      <sl-option value="option-2">Option 2 (pre-selected)</sl-option>
      <sl-option value="option-3">Option 3</sl-option>
    </sl-select>

    <br><br>

    <sl-rating id="ssr-rating" value="3"></sl-rating>

    <div class="status pending" id="status-4">Checking state...</div>
  </div>

  <!-- Test 5: Timing Analysis -->
  <div class="test-section">
    <h2>5. Hydration Timing</h2>
    <ul>
      <li>Page load: <code id="time-load">-</code></li>
      <li>DOM ready: <code id="time-dom">-</code></li>
      <li>Components defined: <code id="time-defined">-</code></li>
      <li>Total hydration: <code id="time-total">-</code></li>
    </ul>
  </div>

  <!-- Shoelace JS (autoloader) - loaded at end -->
  <script type="module">
    const startTime = performance.now();
    document.getElementById('time-load').textContent = `${startTime.toFixed(2)}ms`;

    // Import Shoelace
    import 'https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/shoelace-autoloader.js';

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('time-dom').textContent = `${(performance.now() - startTime).toFixed(2)}ms`;
    });

    // Wait for all components
    async function waitForComponents() {
      const components = [
        'sl-button',
        'sl-input',
        'sl-checkbox',
        'sl-progress-bar',
        'sl-select',
        'sl-option',
        'sl-rating'
      ];

      await Promise.all(components.map(name => customElements.whenDefined(name)));

      const definedTime = performance.now();
      document.getElementById('time-defined').textContent = `${(definedTime - startTime).toFixed(2)}ms`;
      document.getElementById('time-total').textContent = `${(definedTime - startTime).toFixed(2)}ms`;

      return true;
    }

    // Run tests after components are defined
    waitForComponents().then(() => {
      // Test 1: Basic hydration
      const btn1 = document.getElementById('ssr-btn-1');
      const btn2 = document.getElementById('ssr-btn-2');

      if (btn1 && btn2 && btn1.variant === 'primary' && btn2.variant === 'success') {
        document.getElementById('status-1').className = 'status success';
        document.getElementById('status-1').textContent = 'Hydration successful! Buttons are interactive.';
      } else {
        document.getElementById('status-1').className = 'status error';
        document.getElementById('status-1').textContent = 'Hydration failed.';
      }

      // Test 2: Attribute preservation
      const input = document.getElementById('ssr-input');
      const checkbox = document.getElementById('ssr-checkbox');
      const progress = document.getElementById('ssr-progress');

      const attrOk =
        input.value === 'This was set by SSR' &&
        checkbox.checked === true &&
        progress.value === 75;

      if (attrOk) {
        document.getElementById('status-2').className = 'status success';
        document.getElementById('status-2').textContent = 'All attributes preserved correctly!';
      } else {
        document.getElementById('status-2').className = 'status error';
        document.getElementById('status-2').textContent = `Attribute issue: input="${input.value}", checked=${checkbox.checked}, progress=${progress.value}`;
      }

      // Test 3: Event binding
      const hydratedInput = document.getElementById('hydrated-input');
      const hydratedButton = document.getElementById('hydrated-button');
      const inputValue = document.getElementById('input-value');
      const clickCount = document.getElementById('click-count');
      const status3 = document.getElementById('status-3');

      let clicks = 0;
      let inputReceived = false;

      hydratedInput.addEventListener('sl-input', (e) => {
        inputValue.textContent = e.target.value;
        inputReceived = true;
        updateStatus3();
      });

      hydratedButton.addEventListener('click', () => {
        clicks++;
        clickCount.textContent = clicks;
        updateStatus3();
      });

      function updateStatus3() {
        if (inputReceived && clicks > 0) {
          status3.className = 'status success';
          status3.textContent = 'Events working correctly!';
        } else if (inputReceived || clicks > 0) {
          status3.className = 'status pending';
          status3.textContent = 'Partial: ' + (inputReceived ? 'input OK' : 'need input') + ', ' + (clicks > 0 ? 'click OK' : 'need click');
        }
      }

      // Test 4: Complex state
      const select = document.getElementById('ssr-select');
      const rating = document.getElementById('ssr-rating');

      // Need small delay for select to initialize
      setTimeout(() => {
        const stateOk = select.value === 'option-2' && rating.value === 3;

        if (stateOk) {
          document.getElementById('status-4').className = 'status success';
          document.getElementById('status-4').textContent = 'Complex state preserved!';
        } else {
          document.getElementById('status-4').className = 'status error';
          document.getElementById('status-4').textContent = `State issue: select="${select.value}", rating=${rating.value}`;
        }
      }, 100);

      console.log('All hydration tests initialized');
    });
  </script>
</body>
</html>
