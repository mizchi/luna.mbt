<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>@luna_ui/shoelace Playground</title>

  <!-- Shoelace CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/themes/light.css" />

  <style>
    /* Removed :not(:defined) rule for debugging */

    body {
      font-family: var(--sl-font-sans);
      padding: 2rem;
      max-width: 800px;
      margin: 0 auto;
    }

    .section {
      margin-bottom: 2rem;
      padding: 1.5rem;
      border: 1px solid var(--sl-color-neutral-200);
      border-radius: var(--sl-border-radius-medium);
    }

    h2 {
      margin-top: 0;
      color: var(--sl-color-primary-600);
      border-bottom: 2px solid var(--sl-color-primary-200);
      padding-bottom: 0.5rem;
    }

    .demo-row {
      margin-bottom: 1rem;
    }

    .demo-row h3 {
      font-size: 0.875rem;
      color: var(--sl-color-neutral-600);
      margin-bottom: 0.5rem;
    }

    .button-group {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .output {
      margin-top: 0.5rem;
      padding: 0.5rem;
      background: var(--sl-color-neutral-100);
      border-radius: var(--sl-border-radius-small);
      font-family: monospace;
      font-size: 0.875rem;
    }
  </style>
</head>
<body>
  <h1>@luna_ui/shoelace Playground</h1>

  <!-- Button Demo -->
  <div class="section">
    <h2>Button</h2>
    <div id="button-demo"></div>
  </div>

  <!-- Input Demo -->
  <div class="section">
    <h2>Input</h2>
    <div id="input-demo"></div>
  </div>

  <!-- Checkbox Demo -->
  <div class="section">
    <h2>Checkbox</h2>
    <div id="checkbox-demo"></div>
  </div>

  <!-- Switch Demo -->
  <div class="section">
    <h2>Switch</h2>
    <div id="switch-demo"></div>
  </div>

  <!-- Reactive Demo -->
  <div class="section">
    <h2>Reactive (Signal Integration)</h2>
    <div id="reactive-demo"></div>
  </div>

  <!-- Shoelace JS - import components directly instead of autoloader -->
  <script type="module">
    console.log('Playground script starting...');

    // Import Shoelace components directly
    await Promise.all([
      import('https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/components/button/button.js'),
      import('https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/components/input/input.js'),
      import('https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/components/checkbox/checkbox.js'),
      import('https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/components/switch/switch.js'),
    ]);
    console.log('Shoelace components imported');

    let slButton, slButtonReactive, slInput, slInputReactive, slCheckbox, slCheckboxReactive, slSwitch, slSwitchReactive;

    try {
      const mod = await import('../dist/index.mjs');
      console.log('Module imported:', mod);
      ({ slButton, slButtonReactive, slInput, slInputReactive, slCheckbox, slCheckboxReactive, slSwitch, slSwitchReactive } = mod);
    } catch (e) {
      console.error('Import error:', e);
      document.body.innerHTML = '<h1>Import Error</h1><pre>' + e.stack + '</pre>';
      throw e;
    }

    try {
    // Simple Signal implementation for demo
    class Signal {
      constructor(value) {
        this._value = value;
        this._subs = [];
      }
      get() { return this._value; }
      set(v) {
        if (this._value !== v) {
          this._value = v;
          this._subs.forEach(fn => fn(v));
        }
      }
      update(fn) { this.set(fn(this._value)); }
      subscribe(fn) {
        this._subs.push(fn);
        fn(this._value);
        return () => { this._subs = this._subs.filter(s => s !== fn); };
      }
    }

    // ========================================
    // Button Demo
    // ========================================
    {
      const container = document.getElementById('button-demo');

      // Variants
      const row1 = document.createElement('div');
      row1.className = 'demo-row';
      row1.innerHTML = '<h3>Variants</h3>';
      const group1 = document.createElement('div');
      group1.className = 'button-group';

      ['default', 'primary', 'success', 'warning', 'danger'].forEach(variant => {
        group1.appendChild(slButton({ variant }, [variant]));
      });
      row1.appendChild(group1);
      container.appendChild(row1);

      // Sizes
      const row2 = document.createElement('div');
      row2.className = 'demo-row';
      row2.innerHTML = '<h3>Sizes</h3>';
      const group2 = document.createElement('div');
      group2.className = 'button-group';

      ['small', 'medium', 'large'].forEach(size => {
        group2.appendChild(slButton({ variant: 'primary', size }, [size]));
      });
      row2.appendChild(group2);
      container.appendChild(row2);

      // Modifiers
      const row3 = document.createElement('div');
      row3.className = 'demo-row';
      row3.innerHTML = '<h3>Modifiers</h3>';
      const group3 = document.createElement('div');
      group3.className = 'button-group';

      group3.appendChild(slButton({ variant: 'primary', outline: true }, ['Outline']));
      group3.appendChild(slButton({ variant: 'primary', pill: true }, ['Pill']));
      group3.appendChild(slButton({ variant: 'primary', disabled: true }, ['Disabled']));
      group3.appendChild(slButton({ variant: 'primary', loading: true }, ['Loading']));
      row3.appendChild(group3);
      container.appendChild(row3);

      // Click handler
      const row4 = document.createElement('div');
      row4.className = 'demo-row';
      row4.innerHTML = '<h3>Click Handler</h3>';
      const output = document.createElement('div');
      output.className = 'output';
      output.textContent = 'Click count: 0';
      let count = 0;

      row4.appendChild(slButton({
        variant: 'primary',
        onClick: () => {
          count++;
          output.textContent = `Click count: ${count}`;
        }
      }, ['Click me']));
      row4.appendChild(output);
      container.appendChild(row4);
    }

    // ========================================
    // Input Demo
    // ========================================
    {
      const container = document.getElementById('input-demo');

      // Basic
      const row1 = document.createElement('div');
      row1.className = 'demo-row';
      row1.innerHTML = '<h3>Basic</h3>';
      row1.appendChild(slInput({
        label: 'Username',
        placeholder: 'Enter your username'
      }));
      container.appendChild(row1);

      // Types
      const row2 = document.createElement('div');
      row2.className = 'demo-row';
      row2.innerHTML = '<h3>Password with Toggle</h3>';
      row2.appendChild(slInput({
        type: 'password',
        label: 'Password',
        passwordToggle: true,
        placeholder: 'Enter password'
      }));
      container.appendChild(row2);

      // With help text
      const row3 = document.createElement('div');
      row3.className = 'demo-row';
      row3.innerHTML = '<h3>With Help Text</h3>';
      row3.appendChild(slInput({
        type: 'email',
        label: 'Email',
        helpText: 'We will never share your email',
        placeholder: 'you@example.com'
      }));
      container.appendChild(row3);

      // Input event
      const row4 = document.createElement('div');
      row4.className = 'demo-row';
      row4.innerHTML = '<h3>Input Event</h3>';
      const output = document.createElement('div');
      output.className = 'output';
      output.textContent = 'Value: ';

      row4.appendChild(slInput({
        label: 'Type something',
        onInput: (e) => {
          output.textContent = `Value: ${e.target.value}`;
        }
      }));
      row4.appendChild(output);
      container.appendChild(row4);
    }

    // ========================================
    // Checkbox Demo
    // ========================================
    {
      const container = document.getElementById('checkbox-demo');

      const row1 = document.createElement('div');
      row1.className = 'demo-row';
      const output = document.createElement('div');
      output.className = 'output';
      output.textContent = 'Checked: false';

      row1.appendChild(slCheckbox({
        onChange: (e) => {
          output.textContent = `Checked: ${e.target.checked}`;
        }
      }, ['Accept terms and conditions']));
      row1.appendChild(output);
      container.appendChild(row1);

      const row2 = document.createElement('div');
      row2.className = 'demo-row';
      row2.innerHTML = '<h3>States</h3>';
      const group = document.createElement('div');
      group.style.display = 'flex';
      group.style.flexDirection = 'column';
      group.style.gap = '0.5rem';

      group.appendChild(slCheckbox({ checked: true }, ['Checked']));
      group.appendChild(slCheckbox({ disabled: true }, ['Disabled']));
      group.appendChild(slCheckbox({ indeterminate: true }, ['Indeterminate']));
      row2.appendChild(group);
      container.appendChild(row2);
    }

    // ========================================
    // Switch Demo
    // ========================================
    {
      const container = document.getElementById('switch-demo');

      const row1 = document.createElement('div');
      row1.className = 'demo-row';
      const output = document.createElement('div');
      output.className = 'output';
      output.textContent = 'Enabled: false';

      row1.appendChild(slSwitch({
        onChange: (e) => {
          output.textContent = `Enabled: ${e.target.checked}`;
        }
      }, ['Enable notifications']));
      row1.appendChild(output);
      container.appendChild(row1);

      const row2 = document.createElement('div');
      row2.className = 'demo-row';
      row2.innerHTML = '<h3>States</h3>';
      const group = document.createElement('div');
      group.style.display = 'flex';
      group.style.flexDirection = 'column';
      group.style.gap = '0.5rem';

      group.appendChild(slSwitch({ checked: true }, ['On by default']));
      group.appendChild(slSwitch({ disabled: true }, ['Disabled']));
      row2.appendChild(group);
      container.appendChild(row2);
    }

    // ========================================
    // Reactive Demo
    // ========================================
    {
      const container = document.getElementById('reactive-demo');

      // Counter with loading
      const row1 = document.createElement('div');
      row1.className = 'demo-row';
      row1.innerHTML = '<h3>Counter with Loading State</h3>';

      const count = new Signal(0);
      const loading = new Signal(false);

      const btn = slButtonReactive({
        variant: 'primary',
        loadingSignal: loading,
        onClick: () => {
          loading.set(true);
          setTimeout(() => {
            count.update(n => n + 1);
            loading.set(false);
          }, 500);
        }
      }, ['Increment']);

      const countDisplay = document.createElement('span');
      countDisplay.style.marginLeft = '1rem';
      count.subscribe(n => {
        countDisplay.textContent = `Count: ${n}`;
      });

      row1.appendChild(btn);
      row1.appendChild(countDisplay);
      container.appendChild(row1);

      // Two-way binding input
      const row2 = document.createElement('div');
      row2.className = 'demo-row';
      row2.innerHTML = '<h3>Two-way Binding</h3>';

      const name = new Signal('');

      row2.appendChild(slInputReactive({
        label: 'Your name',
        valueSignal: name,
        placeholder: 'Type your name'
      }));

      const greeting = document.createElement('p');
      name.subscribe(n => {
        greeting.textContent = n ? `Hello, ${n}!` : 'Hello, stranger!';
      });
      row2.appendChild(greeting);
      container.appendChild(row2);

      // Checkbox with signal
      const row3 = document.createElement('div');
      row3.className = 'demo-row';
      row3.innerHTML = '<h3>Checkbox with Signal</h3>';

      const agreed = new Signal(false);
      const submitBtn = slButtonReactive({
        variant: 'primary',
        disabledSignal: new Signal(true), // will be updated
      }, ['Submit']);

      // Update button disabled state based on checkbox
      const agreeCheckbox = slCheckboxReactive({
        checkedSignal: agreed,
      }, ['I agree to the terms']);

      agreed.subscribe(checked => {
        if (checked) {
          submitBtn.removeAttribute('disabled');
        } else {
          submitBtn.setAttribute('disabled', '');
        }
      });

      row3.appendChild(agreeCheckbox);
      row3.appendChild(document.createElement('br'));
      row3.appendChild(document.createElement('br'));
      row3.appendChild(submitBtn);
      container.appendChild(row3);
    }

    console.log('@luna_ui/shoelace playground loaded');
    } catch (e) {
      console.error('Playground error:', e);
      document.body.innerHTML += '<h1>Error</h1><pre>' + e.stack + '</pre>';
    }
  </script>
</body>
</html>
